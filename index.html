<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>Anamnese Online | Dra. Natália Magalhães</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Playfair+Display:wght@500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --rose-prim:#B65F56; --rose-apoio:#E6A3A3; --creme:#FCF5EB;
      --border:#e6e0d7; --txt:#2b2b2b; --muted:#7a5e59;
      --radius:18px; --shadow:0 14px 40px rgba(0,0,0,.06);
      --maxw:1000px; --gap:16px;
    }
    *{box-sizing:border-box}
    img{max-width:100%; height:auto; display:block}
    body{margin:0; color:var(--txt); font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Arial; background:var(--creme);}

    header{max-width:var(--maxw);margin:28px auto 0;padding:0 16px 8px; text-align:center}
    .brand{display:flex;flex-direction:column;align-items:center;gap:12px}
    .brand img{width:clamp(160px, 28vw, 300px)}
    @media (max-width:720px){ .brand img{ width:clamp(140px, 42vw, 240px) } }

    .brand h1{
      font-family:"Playfair Display", serif;
      font-weight:600;
      font-size: clamp(16px, 2vw, 22px);
      line-height:1.15; letter-spacing:.2px; color:var(--rose-prim);
      margin:6px 0 0; text-align:center;
    }
    .brand p{margin-top:8px; color:var(--muted); font-size:clamp(12px, 2vw, 14px); max-width:720px; text-align:center;}

    main{max-width:var(--maxw);margin:18px auto 50px;padding:0 16px}
    .card{background:#fff;border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:clamp(16px, 2.8vw, 26px);margin-bottom:18px}
    .section-title{font-size:clamp(13px, 2.2vw, 15px);font-weight:800;letter-spacing:.3px;text-transform:uppercase;color:#5d3c38;margin:0 0 16px;border-left:6px solid var(--rose-prim);padding-left:10px}

    .row{display:grid;grid-template-columns:repeat(2,1fr);gap:var(--gap)}
    .row-3{display:grid;grid-template-columns:repeat(3,1fr);gap:var(--gap)}
    @media (max-width:1024px){ .row-3{grid-template-columns:repeat(2,1fr)} }
    @media (max-width:720px){ .row,.row-3{grid-template-columns:1fr} }

    label{font-size:clamp(12px, 2.2vw, 13.5px); color:#5d3c38; display:block; margin:0 0 8px; font-weight:600}
    input[type="text"],input[type="tel"],input[type="email"],input[type="date"],textarea,select{
      width:100%; padding:14px; min-height:44px; border:1px solid var(--border); border-radius:14px; background:#fff; outline:none; font-size:16px
    }
    textarea{min-height:120px; resize:vertical}
    .inline{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border:1px solid var(--border);border-radius:999px;background:#fff}
    .chip input{accent-color:var(--rose-prim)}
    .hidden{display:none}
    .required::after{content:" *";color:#b45309}
    .success{background:#ecfdf5;border:1px solid #a7f3d0;color:#065f46;padding:16px;border-radius:12px;margin-top:12px;text-align:center}
    .actions{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}

    /* Saúde – visível, mas desabilita quando “Não” */
    .detail.off{opacity:.6}
    .detail.off input{background:#f8f5f0}

    /* Queixa & Interesses — grid limpo */
    .qei-grid{display:grid;grid-template-columns: 1.1fr .9fr;gap:24px;align-items:start}
    @media (max-width:900px){ .qei-grid{ grid-template-columns:1fr } }
    .qei-right{border:1px solid var(--border);border-radius:14px;padding:16px;background:#fff}
    .qei-right .block + .block{ margin-top:16px }
    .chips-wrap{display:flex;flex-wrap:wrap;gap:10px}
    .tight{margin-bottom:8px}
    .btn-cta{--h:56px;display:inline-flex;align-items:center;justify-content:center;gap:10px;min-height:var(--h);padding:0 28px;border:0;border-radius:999px;cursor:pointer;font-weight:800;font-size:17px;color:#fff;background:linear-gradient(135deg,#B65F56 0%,#E6A3A3 100%);box-shadow:0 12px 28px rgba(182,95,86,.25)}
    @media (max-width:720px){ .btn-cta{width:100%} }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <img src="https://dranatmagalhaes.com.br/wp-content/uploads/2024/11/logo-dra-natalia.png" alt="Logo Dra. Natália Magalhães">
      <h1>Avaliação Inicial — O cuidado com você começa aqui</h1>
      <p>Esta anamnese online nos ajuda a conhecer seu histórico e objetivos para preparar um atendimento seguro e personalizado antes da consulta.</p>
    </div>
  </header>

  <main>
    <form id="form" novalidate>
      <!-- DADOS PESSOAIS -->
      <div class="card">
        <div class="section-title">Dados Pessoais</div>
        <div class="row">
          <div><label class="required">Nome completo</label><input type="text" name="nome" required></div>
          <div><label class="required">Data de nascimento</label><input type="date" name="nascimento" required></div>
          <div><label class="required">Telefone (WhatsApp)</label><input type="tel" name="telefone" placeholder="(31) 9 0000-0000" required></div>
          <div><label class="required">E-mail</label><input type="email" name="email" required></div>
          <div><label class="required">Profissão</label><input type="text" name="profissao" required></div>
          <div>
            <label class="required">Cidade/Estado</label>
            <input type="text" name="cidade" placeholder="Ex.: Belo Horizonte/MG" required>
          </div>
        </div>
      </div>

      <!-- QUEIXA & INTERESSES -->
      <div class="card">
        <div class="section-title">Queixa & Interesses (Estética Regenerativa)</div>

        <!-- pequeno seletor para guiar o placeholder -->
        <div class="row" style="margin-bottom:10px">
          <div>
            <label class="required">Objetivo principal com o tratamento</label>
            <select name="objetivo" id="objetivo" required>
              <option value="">Selecione…</option>
              <option value="flacidez">Flacidez/pele</option>
              <option value="contorno">Contorno/volume</option>
              <option value="rejuvenescer">Rejuvenescer geral</option>
              <option value="harmonia">Harmonização facial</option>
              <option value="prevencao">Prevenção</option>
              <option value="outro">Outro</option>
            </select>
          </div>
        </div>

        <div class="qei-grid">
          <!-- ESQUERDA: QUEIXA -->
          <div>
            <label class="required">O que mais te incomoda hoje ou o que você gostaria de melhorar?</label>
            <textarea name="queixa" id="queixa" placeholder="Descreva brevemente sua principal queixa…" required></textarea>
          </div>

          <!-- DIREITA: INTERESSES + INVESTIMENTO -->
          <div class="qei-right">
            <div class="block">
              <label class="tight">Quais procedimentos te interessam?</label>
              <div class="chips-wrap" id="chipsInteresse">
                <label class="chip"><input type="checkbox" name="procInteresse" value="Botox"> Botox</label>
                <label class="chip"><input type="checkbox" name="procInteresse" value="Bioreconexão"> Bioreconexão</label>
                <label class="chip"><input type="checkbox" name="procInteresse" value="Ultraformer"> Ultraformer</label>
                <label class="chip"><input type="checkbox" name="procInteresse" value="Reset"> Reset</label>
                <label class="chip"><input type="checkbox" name="procInteresse" value="Exocoll"> Exocoll</label>
                <label class="chip"><input type="checkbox" name="procInteresse" value="Protocoll"> Protocoll</label>
                <label class="chip"><input type="checkbox" name="procInteresse" value="Bioestimulador de colágeno"> Bioestimulador de colágeno</label>
                <label class="chip"><input type="checkbox" name="procInteresse" value="Preenchimento labial"> Preenchimento labial</label>
                <label class="chip"><input type="checkbox" name="procInteresse" value="Outros"> Outros…</label>
              </div>
            </div>

            <div class="block">
              <label class="tight">Qual faixa de investimento você considera neste momento?</label>
              <div class="chips-wrap" id="wrapInvest">
                <label class="chip"><input type="radio" name="faixaInvest" value="Até 2.000"> Até R$ 2.000</label>
                <label class="chip"><input type="radio" name="faixaInvest" value="2.000–3.500"> R$ 2.000–3.500</label>
                <label class="chip"><input type="radio" name="faixaInvest" value="3.500–6.000"> R$ 3.500–6.000</label>
                <label class="chip"><input type="radio" name="faixaInvest" value="Acima de 6.000"> Acima de R$ 6.000</label>
                <label class="chip"><input type="radio" name="faixaInvest" value="Quero avaliar com a Dra."> Quero avaliar com a Dra.</label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- HISTÓRICO ESTÉTICO -->
      <div class="card">
        <div class="section-title">Histórico Estético</div>
        <div class="row">
          <div>
            <label class="required">Já fez procedimentos estéticos?</label>
            <div class="inline">
              <label class="chip"><input type="radio" name="jaFez" value="N" checked> Não</label>
              <label class="chip"><input type="radio" name="jaFez" value="S"> Sim</label>
            </div>
          </div>
          <!-- aparece só quando “Sim” -->
          <div id="wrap-quais-fez" class="hidden">
            <label>Quais?</label>
            <input type="text" name="quaisFez" placeholder="Ex.: toxina, preenchedor, bioestimulador…">
          </div>

          <div>
            <label class="required">Você já é paciente da Dra. Natália?</label>
            <div class="inline">
              <label class="chip"><input type="radio" name="jaPaciente" value="N" checked> Não</label>
              <label class="chip"><input type="radio" name="jaPaciente" value="S"> Sim</label>
            </div>
          </div>
        </div>
      </div>

      <!-- SAÚDE (visível; desabilita quando “Não”) -->
      <div class="card">
        <div class="section-title">Saúde</div>
        <div class="row">
          <div>
            <label class="required">Alergia a medicamentos?</label>
            <div class="inline">
              <label class="chip"><input type="radio" name="alergiaMedicamentos" value="N" checked> Não</label>
              <label class="chip"><input type="radio" name="alergiaMedicamentos" value="S"> Sim</label>
            </div>
          </div>
          <div id="wrap-alergia-meds" class="detail off"><label>Quais medicamentos (alergia)?</label><input type="text" name="quaisAlergiaMedicamentos" aria-disabled="true" disabled></div>

          <div>
            <label class="required">Possui outras alergias?</label>
            <div class="inline">
              <label class="chip"><input type="radio" name="alergiasGerais" value="N" checked> Não</label>
              <label class="chip"><input type="radio" name="alergiasGerais" value="S"> Sim</label>
            </div>
          </div>
          <div id="wrap-alergias" class="detail off"><label>Quais alergias?</label><input type="text" name="quaisAlergias" aria-disabled="true" disabled></div>

          <div>
            <label class="required">Usa medicamentos?</label>
            <div class="inline">
              <label class="chip"><input type="radio" name="usaMedicamentos" value="N" checked> Não</label>
              <label class="chip"><input type="radio" name="usaMedicamentos" value="S"> Sim</label>
            </div>
          </div>
          <div id="wrap-usa-meds" class="detail off"><label>Quais medicamentos?</label><input type="text" name="quaisMedicamentos" aria-disabled="true" disabled></div>

          <div>
            <label class="required">Doenças/pré-existências</label>
            <div class="inline">
              <label class="chip"><input type="checkbox" name="doencas" value="Diabetes"> Diabetes</label>
              <label class="chip"><input type="checkbox" name="doencas" value="Hipertensão"> Hipertensão</label>
              <label class="chip"><input type="checkbox" name="doencas" value="Cardíacas"> Cardíacas</label>
              <label class="chip"><input type="checkbox" name="doencas" value="Autoimunes"> Autoimunes</label>
              <label class="chip"><input type="checkbox" name="doencas" value="Nenhuma" checked> Nenhuma</label>
            </div>
          </div>

          <div>
            <label class="required">Gestante ou amamentando?</label>
            <div class="inline">
              <label class="chip"><input type="radio" name="gestante" value="N" checked> Não</label>
              <label class="chip"><input type="radio" name="gestante" value="S"> Sim</label>
            </div>
          </div>

          <div>
            <label class="required">Uso de anabolizantes?</label>
            <div class="inline">
              <label class="chip"><input type="radio" name="anabolizantes" value="N" checked> Não</label>
              <label class="chip"><input type="radio" name="anabolizantes" value="S"> Sim</label>
            </div>
          </div>
          <div id="wrap-anabolizantes" class="detail off"><label>Quais (anabolizantes)?</label><input type="text" name="quaisAnabolizantes" aria-disabled="true" disabled></div>

          <div>
            <label class="required">Cirurgias recentes (últimos 12 meses)?</label>
            <div class="inline">
              <label class="chip"><input type="radio" name="cirurgiaRecente" value="N" checked> Não</label>
              <label class="chip"><input type="radio" name="cirurgiaRecente" value="S"> Sim</label>
            </div>
          </div>
          <div id="wrap-cirurgias" class="detail off"><label>Quais cirurgias?</label><input type="text" name="quaisCirurgias" aria-disabled="true" disabled></div>
        </div>

        <div class="row">
          <div>
            <label class="required">Tabagismo</label>
            <div class="inline">
              <label class="chip"><input type="radio" name="tabagismo" value="N" checked> Não</label>
              <label class="chip"><input type="radio" name="tabagismo" value="S"> Sim</label>
            </div>
          </div>
          <div id="wrap-tabagismo" class="detail off"><label>Tabagismo – detalhes</label><input type="text" name="tabagismoDetalhes" aria-disabled="true" disabled></div>

          <div>
            <label class="required">Álcool</label>
            <div class="inline">
              <label class="chip"><input type="radio" name="alcool" value="N" checked> Não</label>
              <label class="chip"><input type="radio" name="alcool" value="S"> Sim</label>
            </div>
          </div>
          <div id="wrap-alcool" class="detail off"><label>Álcool – frequência/quantidade</label><input type="text" name="alcoolDetalhes" placeholder="Ex.: 1–2x/semana; 2 doses/vez" aria-disabled="true" disabled></div>

          <div>
            <label class="required">Atividade física</label>
            <div class="inline">
              <label class="chip"><input type="radio" name="atividadeFisica" value="N" checked> Não</label>
              <label class="chip"><input type="radio" name="atividadeFisica" value="S"> Sim</label>
            </div>
          </div>
          <div id="wrap-atividade" class="detail off"><label>Atividade física – tipo/frequência</label><input type="text" name="atividadeFisicaDetalhes" placeholder="Ex.: musculação 3x/semana, 45min" aria-disabled="true" disabled></div>
        </div>
      </div>

      <!-- FOTOS -->
      <div class="card">
        <div class="section-title">Fotos para Avaliação</div>
        <p class="muted">Envie 3 fotos: Frente, Perfil esquerdo e Perfil direito (luz natural, fundo neutro).</p>
        <div class="row-3">
          <div><label>Frente</label><input type="file" id="selfieFront" accept="image/*" capture="user"><img id="previewFront" class="hidden" style="width:100%;max-width:260px;border:1px solid var(--border);border-radius:12px" alt="Prévia frente"><input type="hidden" name="selfieFrontDataURL"></div>
          <div><label>Perfil esquerdo</label><input type="file" id="selfieLeft" accept="image/*" capture="user"><img id="previewLeft" class="hidden" style="width:100%;max-width:260px;border:1px solid var(--border);border-radius:12px" alt="Prévia perfil esquerdo"><input type="hidden" name="selfieLeftDataURL"></div>
          <div><label>Perfil direito</label><input type="file" id="selfieRight" accept="image/*" capture="user"><img id="previewRight" class="hidden" style="width:100%;max-width:260px;border:1px solid var(--border);border-radius:12px" alt="Prévia perfil direito"><input type="hidden" name="selfieRightDataURL"></div>
        </div>
      </div>

      <!-- LGPD -->
      <div class="card">
        <div class="section-title">Privacidade & LGPD</div>
        <div class="inline" style="background:#fff7ed;border:1px solid #f2d7be;border-radius:12px;padding:12px">
          <input type="checkbox" id="lgpd" name="lgpd" required style="margin-right:8px">
          <label for="lgpd" class="required" style="margin:0">Autorizo o uso dos meus dados para fins de contato, avaliação e propostas, conforme a LGPD.</label>
        </div>
      </div>

      <div class="actions"><button type="submit" class="btn-cta">Enviar anamnese</button></div>
      <div id="feedback" class="success hidden"></div>

      <!-- UTM & tech + honeypot -->
      <input type="hidden" name="utm_source"><input type="hidden" name="utm_medium"><input type="hidden" name="utm_campaign"><input type="hidden" name="utm_content"><input type="hidden" name="utm_term"><input type="hidden" name="ua"><input type="hidden" name="ip">
      <input type="text" name="_hp" style="position:absolute;left:-9999px;opacity:0" tabindex="-1" autocomplete="off">
    </form>
  </main>

  <footer style="text-align:center; margin:40px 0; font-size:12px; color:#7a5e59; line-height:1.6;">
    © 2025 Dra. Natália Magalhães – Todos os direitos reservados.<br>
    <span style="background:linear-gradient(135deg,#B65F56 0%,#E6A3A3 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;display:inline-block;">
      Desenvolvido por Noelle Ventura
    </span>
  </footer>

  <script>
    // >>> ajuste aqui se o Apps Script mudar <<<
    const EXEC_URL = 'https://script.google.com/macros/s/AKfycbwqQ7Z5HIyd5htdmTkSP45cJr-eBx7ysQV1t4GkQluTBN25yX3a3ewHckb_8gUQ1k93/exec';
    const SECRET   = 'nm_2025_24jun86_bynv';

    const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
    const getRadio=(name)=>(document.querySelector(`input[name="${name}"]:checked`)||{}).value||'';

    // Placeholders dinâmicos para "queixa"
    const PLACEHOLDERS = {
      flacidez: "Ex.: flacidez no terço inferior; perda de firmeza; queda do contorno mandibular…",
      contorno: "Ex.: perda de volume malar; pouca definição de mandíbula/queixo; lábios com pouco volume…",
      rejuvenescer: "Ex.: rugas na testa/pés-de-galinha; textura cansada; desejo de rejuvenescer mantendo naturalidade…",
      harmonia: "Ex.: assimetrias leves; desejo de equilíbrio dos traços; melhorar proporcionalidade do rosto…",
      prevencao: "Ex.: começar cuidado preventivo; manter qualidade da pele; evitar avanço de linhas…",
      outro: "Descreva brevemente sua principal queixa…"
    };

    function updateQueixaPlaceholder(){
      const objetivo = (document.getElementById('objetivo')||{}).value || '';
      const queixa = document.getElementById('queixa');
      // se objetivo não escolhido, inferir pelo primeiro procedimento marcado
      if(!objetivo){
        const firstChecked = document.querySelector('input[name="procInteresse"]:checked');
        if(firstChecked){
          const val = firstChecked.value.toLowerCase();
          if(val.includes('ultraformer') || val.includes('bioestimulador')) queixa.placeholder = PLACEHOLDERS['flacidez'];
          else if(val.includes('preenchimento') || val.includes('labial')) queixa.placeholder = PLACEHOLDERS['contorno'];
          else if(val.includes('botox') || val.includes('reset') || val.includes('exocoll') || val.includes('protocoll')) queixa.placeholder = PLACEHOLDERS['rejuvenescer'];
          else queixa.placeholder = PLACEHOLDERS['outro'];
          return;
        }
      }
      queixa.placeholder = PLACEHOLDERS[objetivo||'outro'];
    }

    // Histórico estético: “Quais?” só quando “Sim”
    function toggleHist(){
      const on = getRadio('jaFez')==='S';
      const wrap = document.getElementById('wrap-quais-fez');
      wrap.classList.toggle('hidden', !on);
      const input = document.querySelector('input[name="quaisFez"]');
      input.disabled = !on;
      if(!on) input.value='';
      const lbl = wrap.querySelector('label'); if (lbl) lbl.classList.toggle('required', on);
    }

    // Saúde: visível sempre; desabilita quando “Não”
    const saudeDeps = [
      { name:'alergiaMedicamentos', wrap:'wrap-alergia-meds',  input:'input[name="quaisAlergiaMedicamentos"]' },
      { name:'alergiasGerais',      wrap:'wrap-alergias',      input:'input[name="quaisAlergias"]' },
      { name:'usaMedicamentos',     wrap:'wrap-usa-meds',      input:'input[name="quaisMedicamentos"]' },
      { name:'anabolizantes',       wrap:'wrap-anabolizantes', input:'input[name="quaisAnabolizantes"]' },
      { name:'cirurgiaRecente',     wrap:'wrap-cirurgias',     input:'input[name="quaisCirurgias"]' },
      { name:'tabagismo',           wrap:'wrap-tabagismo',     input:'input[name="tabagismoDetalhes"]' },
      { name:'alcool',              wrap:'wrap-alcool',        input:'input[name="alcoolDetalhes"]' },
      { name:'atividadeFisica',     wrap:'wrap-atividade',     input:'input[name="atividadeFisicaDetalhes"]' },
    ];
    function toggleSaude(){
      const byYes = n=> getRadio(n)==='S';
      saudeDeps.forEach(d=>{
        const wrap  = document.getElementById(d.wrap);
        const input = document.querySelector(d.input);
        const on = byYes(d.name);
        input.disabled = !on;
        wrap.classList.toggle('off', !on);
        const lbl = wrap.querySelector('label'); if (lbl) lbl.classList.toggle('required', on);
        if (!on) input.value='';
      });
    }

    // eventos dinâmicos
    document.addEventListener('change', e=>{
      if (e.target && e.target.name==='jaFez') toggleHist();
      if (['alergiaMedicamentos','alergiasGerais','usaMedicamentos','anabolizantes','cirurgiaRecente','tabagismo','alcool','atividadeFisica'].includes(e.target.name)) toggleSaude();
      if (e.target && (e.target.id==='objetivo' || e.target.name==='procInteresse')) updateQueixaPlaceholder();
    });

    // estado inicial
    toggleHist(); toggleSaude(); updateQueixaPlaceholder();

    // UTM & tech
    const params=new URLSearchParams(location.search);
    ['utm_source','utm_medium','utm_campaign','utm_content','utm_term'].forEach(k=>{
      const v=params.get(k); if(v) document.querySelector(`input[name="${k}"]`).value=v;
    });
    document.querySelector('input[name="ua"]').value=navigator.userAgent||'';

    // Fotos → dataURL comprimido
    async function fileToDataURL(file,maxW=1400,quality=0.86){
      return new Promise(resolve=>{
        const fr=new FileReader();
        fr.onload=()=>{const img=new Image(); img.onload=()=>{const s=Math.min(1,maxW/img.width); const w=Math.round(img.width*s), h=Math.round(img.height*s); const c=document.createElement('canvas'); c.width=w; c.height=h; const ctx=c.getContext('2d'); ctx.drawImage(img,0,0,w,h); resolve(c.toDataURL('image/jpeg',quality));}; img.src=fr.result;}; fr.readAsDataURL(file);
      });
    }
    function bindPhoto(inputId, hiddenName, previewId){
      const input=document.getElementById(inputId), prev=document.getElementById(previewId);
      input.addEventListener('change',async e=>{const f=e.target.files&&e.target.files[0]; if(!f) return; const d=await fileToDataURL(f); const hidden = document.querySelector(`input[name="${hiddenName}"]`);
        if (hidden) hidden.value=d; prev.src=d; prev.classList.remove('hidden');});
    }
    bindPhoto('selfieFront','selfieFrontDataURL','previewFront');
    bindPhoto('selfieLeft','selfieLeftDataURL','previewLeft');
    bindPhoto('selfieRight','selfieRightDataURL','previewRight');

    // Coleta + validação + envio
    function collect(formEl){
      const data={};
      $$('input[type="text"]:not([disabled]),input[type="email"]:not([disabled]),input[type="tel"]:not([disabled]),input[type="date"]:not([disabled]),input[type="hidden"]:not([disabled]),textarea:not([disabled]),select:not([disabled])',formEl)
        .forEach(el=>data[el.name]=el.value.trim());
      ['jaFez','jaPaciente','usaMedicamentos','alergiaMedicamentos','alergiasGerais','gestante','anabolizantes','cirurgiaRecente','tabagismo','alcool','atividadeFisica']
        .forEach(n=> data[n]=(document.querySelector(`input[name="${n}"]:checked`)||{}).value || '' );
      data['doencas']=$$('input[name="doencas"]:checked').map(el=>el.value);
      data['procInteresse']=$$('input[name="procInteresse"]:checked').map(el=>el.value);

      // faixa de investimento opcional -> default se vazio
      const invest = (document.querySelector('input[name="faixaInvest"]:checked')||{}).value||'';
      data['faixaInvest'] = invest || 'Quero avaliar com a Dra.';

      data['lgpd']=document.querySelector('input[name="lgpd"]').checked;
      return data;
    }
    function validate(formEl){
      const req=formEl.querySelectorAll('[required]');
      for(const r of req){
        if(r.type==='checkbox' && !r.checked) return false;
        if(r.type!=='checkbox' && r.value.trim()==='') return false;
      }
      if (formEl.querySelector('input[name="_hp"]').value) return false; // honeypot
      return true;
    }

    const form=document.getElementById('form'); const feedback=document.getElementById('feedback');
    form.addEventListener('submit',async e=>{
      e.preventDefault();
      if(!validate(form)){
        feedback.classList.remove('hidden');
        feedback.textContent='Preencha os obrigatórios e confirme a LGPD.';
        feedback.scrollIntoView({behavior:'smooth'});
        return;
      }
      const payload=collect(form);
      const body = new URLSearchParams({ secret: SECRET, payload: JSON.stringify(payload) });

      feedback.classList.remove('hidden'); feedback.textContent='Enviando…';
      try{
        const res = await fetch(EXEC_URL, { method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded'}, body });
        const data = await res.json();
        if(data.ok && data.whatsapp){ window.location.href = data.whatsapp; }
        else { feedback.textContent = 'Houve um problema ao enviar. Tente novamente.'; }
      }catch(err){
        feedback.textContent = 'Erro ao enviar: ' + err;
      }
    });
  </script>
</body>
</html>
